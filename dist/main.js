"use strict";const r=require("siyuan");async function f(){let t=b(),[n,i]=await w(t),e="";e=await a(n,i,e),e!=""&&y(t,e)}async function w(t){let n=await r.serverApi.sql(`SELECT * FROM blocks WHERE id = '${t}'`),i=n[0].box,e=n[0].path;return[i,e]}function b(){var t;return(t=document.querySelector(".layout__wnd--active .protyle.fn__flex-1:not(.fn__none) .protyle-background"))==null?void 0:t.getAttribute("data-node-id")}async function g(t,n){let i=r.serverApi.request("/api/filetree/listDocsByPath",{notebook:t,path:n}),e=await r.serverApi.parseBody(i);return e==null?[]:e.files}function v(t,n){return t==""||t==null?n?"üìë":"üìÑ":String.fromCodePoint(parseInt(t,16))}async function a(t,n,i,e=0){let c=await g(t,n);e++;for(let o of c){let u=o.id,d=o.name.slice(0,-3),p=o.icon,l=o.subFileCount,h=o.path;for(let s=0;s<e;s++)i+="  ";i+=`* ${v(p,l!=0)}[${d}](siyuan://blocks/${u})
`,l>0&&(i=await a(t,h,i,e))}return i}async function y(t,n){await r.serverApi.prependBlock(t,"markdown",n)}class m extends r.Plugin{constructor(){super()}insertIcon(){this.el=document.createElement("div"),this.el.classList.add("toolbar__item","b3-tooltips","b3-tooltips__se"),this.el.setAttribute("aria-label","ÊèíÂÖ•ÁõÆÂΩï"),this.el.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12H3"></path><path d="M16 6H3"></path><path d="M16 18H3"></path><path d="M18 9v6"></path><path d="M21 12h-6"></path></svg>',this.el.addEventListener("click",()=>{f()}),r.clientApi.addToolbarRight(this.el)}onload(){this.insertIcon()}onunload(){this.el.remove()}}module.exports=m;
