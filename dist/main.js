"use strict";const o=require("siyuan");async function s(){let t=w(),[n,i]=await m(t),e="";e=await c(n,i,e),e!=""&&v(t,e)}async function m(t){let n=await o.serverApi.sql(`SELECT * FROM blocks WHERE id = '${t}'`),i=n[0].box,e=n[0].path;return[i,e]}function w(){var t;return(t=document.querySelector(".layout__wnd--active .protyle.fn__flex-1:not(.fn__none) .protyle-background"))==null?void 0:t.getAttribute("data-node-id")}async function b(t,n){let i=o.serverApi.request("/api/filetree/listDocsByPath",{notebook:t,path:n}),e=await o.serverApi.parseBody(i);return e==null?[]:e.files}function g(t,n){return t==""||t==null?n?"📑":"📄":String.fromCodePoint(parseInt(t,16))}async function c(t,n,i,e=0){let u=await b(t,n);e++;for(let r of u){let d=r.id,p=r.name.slice(0,-3),h=r.icon,a=r.subFileCount,f=r.path;for(let l=0;l<e;l++)i+="  ";i+=`* ${g(h,a!=0)}[${p}](siyuan://blocks/${d})
`,a>0&&(i=await c(t,f,i,e))}return i}async function v(t,n){await o.serverApi.prependBlock(t,"markdown",n)}class y extends o.Plugin{constructor(){super()}insertIcon(){this.el=document.createElement("div"),this.el.classList.add("toolbar__item","b3-tooltips","b3-tooltips__se"),this.el.setAttribute("aria-label","插入目录"),this.el.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12H3"></path><path d="M16 6H3"></path><path d="M16 18H3"></path><path d="M18 9v6"></path><path d="M21 12h-6"></path></svg>',this.el.addEventListener("click",()=>{s()}),o.clientApi.addToolbarRight(this.el)}onload(){this.insertIcon(),this.registerCommand({command:"ic",shortcut:"ctrl+alt+i,command+option+e",description:"插入目录",callback:s})}onunload(){this.el.remove()}}module.exports=y;
